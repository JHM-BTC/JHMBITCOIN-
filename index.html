<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Treasure Map â€” Welcome & Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- (opsional tapi cakep) font Orbitron buat 3D headline -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@800;900&display=swap" rel="stylesheet">
    <style>
        /* ================= GLOBAL STYLES & FONTS ================= */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        html, body { height: 100%; width: 100%; overflow-y: auto !important; overscroll-behavior-y: contain; }
        body { font-family: 'Inter', sans-serif; background: #14335f; min-height: 100vh; overflow-y: auto !important; }

        /* ================= FIXED BACKGROUNDS ================= */
        .bg-hero { background: url('https://blogger.googleusercontent.com/img/a/AVvXsEhs_ZO5OnA0Q4Ex0Epuu_-sdtSNXQCB6BGJt3oN6L9JHuwJTX_qvQSrKy0eepPl_v7KnFbxmnmXqjQu79ElLlo47XLiJ91w0hrUmaHLABnc0hM0VpYftUkwitSdzy94xovlQa3OzRVKcNzGsB5FzaleKCzkiqxeZz8heWizjq2VcHeygZAkGhJtAkdJRHA') center/cover no-repeat; position: fixed; inset: 0; width: 100vw; height: 100vh; z-index: 0; overflow: hidden; }
        .shine-effect { position: absolute; inset: 0; pointer-events: none; z-index: 1; background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.18) 40%, rgba(255,255,255,0.38) 50%, rgba(255,255,255,0.18) 60%, rgba(255,255,255,0) 100%); opacity: .7; animation: shineMove 3.5s linear infinite; filter: blur(2px); }
        @keyframes shineMove { 0% { transform: translateX(-60vw) skewX(-18deg); } 100% { transform: translateX(120vw) skewX(-18deg); } }
        .bg-game { background: url('https://blogger.googleusercontent.com/img/a/AVvXsEgrcnQcPPcfE9A-hKDw7ESeN_N3Elivbjm1Qd21Iny4lUjt3e2enRw5Re482KPvPZQq4w9tLw9-BthklRaLGySVkZZwUO5qedf81xDawq4mR70BN-Q6WYNUvmF13sjJnkA5ze82lwXtlVt2L3q94VF2DBpW_5O3J_b3aBFQJB2wYvGQ9CHKtGOx6m9lZ5o') center/cover no-repeat; position: fixed; inset: 0; width: 100vw; height: 100vh; z-index: 0; }
        .shine-effect-gold { position: absolute; inset: 0; pointer-events: none; z-index: 1; background: linear-gradient(100deg, rgba(255,255,255,0) 0%, rgba(255,215,0,0.12) 30%, rgba(255,255,255,0.22) 38%, rgba(255,215,0,0.38) 50%, rgba(255,255,255,0.22) 62%, rgba(255,215,0,0.12) 70%, rgba(255,255,255,0) 100%); opacity: .85; animation: shineGoldMove 4.5s cubic-bezier(.4,1.6,.6,1) infinite; filter: blur(7px) brightness(1.3) saturate(1.4); mix-blend-mode: lighten; }
        @keyframes shineGoldMove { 0% { transform: translateX(-80vw) skewX(-22deg) scaleY(1.1); } 40% { transform: translateX(10vw) skewX(-18deg) scaleY(1.13); } 60% { transform: translateX(30vw) skewX(-16deg) scaleY(1.18); } 100% { transform: translateX(120vw) skewX(-22deg) scaleY(1.1); } }

        /* ================= HERO CONTENT & STYLES ================= */
        .section-content { position: relative; z-index: 2; width: 100%; }
        .hero-map-frame { display: flex; justify-content: center; align-items: center; margin: 5vw auto 0; width: 100%; position: relative; z-index: 10; }
        .neon-glow-border { border-radius: 2.2rem; box-shadow: 0 0 0 22px #1ff1ff88, 0 0 66px 14px #1afcffcc, 0 0 260px 70px #0de7ff66, 0 0 360px 110px #29fffccc; border: 6px solid #5efcf1; background: rgba(20,40,60,.45); padding: 1vw; transition: box-shadow .3s; }
        .neon-glow-border:hover { box-shadow: 0 0 0 30px #29fffebb, 0 0 250px 100px #07d8ffcc, 0 0 800px 160px #43fffccc; }
        .hero-map-img { width: 820px; max-width: 98vw; height: auto; display: block; border-radius: 1.8rem; box-shadow: 0 8px 48px 12px #02162daa; background: #18345d; }
        @media (max-width: 900px) { .hero-map-img { width: 95vw; } .neon-glow-border { padding: 2vw; } }
        @media (max-width: 650px) { .hero-map-img { width: 99vw; } .neon-glow-border { padding: 1.5vw; } .hero-map-frame { margin-top: 7vw; } }

        .glow-hero { /* (masih ada kalau mau pakai lagi di tempat lain) */
          background: linear-gradient(90deg, #fffbe7 0%, #ffe259 25%, #ffd700 50%, #fff700 75%, #fffbe7 100%);
          -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent;
          text-shadow: 0 0 36px #fffbe7, 0 0 60px #ffd700, 0 0 80px #fff700, 0 2px 0 #fffbe7, 0 0 24px #ffd700;
          font-size: 2.3rem; font-weight: 900; letter-spacing: 2px; margin-top: 2.5rem; margin-bottom: 1.5rem;
        }
        @media (max-width: 700px) { .glow-hero { font-size: 1.25rem; margin-top: 1.2rem; } }
        .hero-btn { margin-top: 28px; font-size: 1.08rem; padding: 14px 64px; border-radius: 9999px; font-weight: 700; background: linear-gradient(90deg, #fffbe7 0%, #ffe259 25%, #ffd700 50%, #fff700 75%, #fffbe7 100%); color: #222; box-shadow: 0 0 0 8px #ffd700cc, 0 0 32px 8px #fffbe7cc, 0 0 120px 40px #ffd70088; border: 3px solid #ffd700; text-shadow: 0 0 18px #fffbe7, 0 2px 0 #ffd700; letter-spacing: 2px; transition: transform .15s, box-shadow .15s; }
        .hero-btn:hover { transform: scale(1.06); box-shadow: 0 0 0 16px #ffd700cc, 0 0 64px 16px #fffbe7cc, 0 0 240px 80px #ffd70088; color: #111; }

        /* ================= GAME STYLES ================= */
        #island-container { max-width: 1400px; margin: 0 auto; display: flex; flex-direction: row; justify-content: center; align-items: flex-start; gap: 4rem; perspective: 1800px; min-height: 420px; flex-wrap: nowrap; }
        .island-card-wrapper { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; flex-shrink: 0; margin: 0 !important; }
        .island-card { width: 340px; height: 520px; background: linear-gradient(135deg, #13243a 80%, #21e3ff 100%); border-radius: 2.6rem; box-shadow: 0 0 0 8px rgba(255,215,0,.45), 0 0 32px 8px rgba(255,215,0,.35), 0 0 120px 40px rgba(255,215,0,.18), 0 0 220px 60px rgba(255,215,0,.10); border: 3px solid #FFD700; transition: transform .6s cubic-bezier(.4,2,.2,1), box-shadow .2s; cursor: pointer; position: relative; overflow: hidden; transform-style: preserve-3d; min-width: 120px; min-height: 160px; max-width: 98vw; }
        .island-card.flipped { transform: rotateY(180deg) scale(1.08); box-shadow: 0 0 0 12px rgba(144,238,144,.5), 0 0 80px 30px rgba(144,238,144,.25), 0 0 200px 60px rgba(144,238,144,.12); border: 4px solid #90EE90; }
        .island-card.shuffling-anim { animation: cardShuffle .05s linear infinite; }
        @keyframes cardShuffle { 0% { transform: translateX(0) rotateY(0) scale(1); } 25% { transform: translateX(-150px) rotateY(180deg) scale(1.1); } 50% { transform: translateX(0) rotateY(360deg) scale(1); } 75% { transform: translateX(150px) rotateY(540deg) scale(1.1); } 100% { transform: translateX(0) rotateY(720deg) scale(1); } }
        .island-card .island-front, .island-card .island-back { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 2.5rem; backface-visibility: hidden; transition: transform .6s; }
        .island-card .island-front { transform: rotateY(0); }
        .island-card .island-back { background: #111b2b; transform: rotateY(180deg); }
        .island-card.flipped .island-front { transform: rotateY(-180deg); }
        .island-card.flipped .island-back { transform: rotateY(0); }
        .island-card .island-img { width: 85%; height: 85%; object-fit: contain; border-radius: 1.5rem; border: none; box-shadow: 0 8px 48px 0 #3b82f6cc; background: #18345d; }
        .card-front-logo { width: 85%; height: 85%; object-fit: contain; padding: 1.1rem; }
        #spinButton { width: 99vw; max-width: 390px; font-size: 1.24rem; padding: 1.1rem 0; border-radius: 9999px; font-weight: 900; margin-top: 2.2rem; margin-bottom: 1.2rem; box-shadow: 0 18px 88px 0 #fbbf24cc, 0 0 90px #fff700; letter-spacing: 2px; background: linear-gradient(90deg, #ffe259 0%, #ffa751 100%); text-shadow: 0 0 18px #fff, 0 2px 0 #000, 0 0 32px #ffd700; border: 5px solid #fff700; transition: transform .15s, box-shadow .15s; }
        #spinButton:hover:not(:disabled) { transform: scale(1.04); box-shadow: 0 16px 80px 0 #ffd700cc, 0 0 80px #fff700; }
        #spinButton:disabled { cursor: not-allowed; opacity: .6; }
        .neon-title { font-size: 4rem; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; background: linear-gradient(90deg, #fffbe7 0%, #ffe259 25%, #ffd700 50%, #fff700 75%, #fffbe7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; text-shadow: 0 0 36px #fffbe7, 0 0 60px #ffd700, 0 0 80px #fff700, 0 2px 0 #fffbe7, 0 0 24px #ffd700; margin-bottom: 2.5rem; }
        @media (max-width: 900px) { .neon-title { font-size: 2.7rem; } }
        @media (max-width: 650px) { .neon-title { font-size: 1.6rem; } }
        @media (max-width: 1200px) { #island-container { gap: 2.5rem; } .island-card { width: 260px; height: 380px; } }
        @media (max-width: 900px) { #island-container { gap: 1.7rem; } .island-card { width: 200px; height: 300px; } }
        @media (max-width: 800px) { #island-container { gap: 1.1rem; } .island-card { width: 160px; height: 210px; } }
        @media (max-width: 650px) { #island-container { flex-direction: column; align-items: center; gap: 1.2rem; flex-wrap: wrap; } .island-card-wrapper { width: 97vw; min-width: 0; max-width: 99vw; } .island-card { width: 98vw; height: 170px; min-width: 0; max-width: 99vw; margin: 0 auto; } .island-card .island-img, .card-front-logo { width: 62% !important; height: 62% !important; padding: .22rem; } .neon-title { font-size: 1.3rem; } #spinButton { font-size: 1.1rem; padding: .9rem 0; } }
        @media (max-width: 430px) { .hero-btn { font-size: .62rem; padding: 7px 6px; } .hero-map-frame { margin-top: 7vw; } .neon-glow-border { padding: .2vw; } }

        /* --- Header fix global --- */
        .header-full { left: 0; right: 0; top: 0; width: 100% !important; }

        /* ================= CUSTOM MODAL STYLES ================= */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.75); display: flex; justify-content: center; align-items: center; z-index: 1000; transition: opacity 0.3s ease; }
        .modal-content { background: #1a2d4b; padding: 2rem; border-radius: 1.5rem; text-align: center; box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); transform: scale(0.9); transition: transform 0.3s ease; max-width: 400px; width: 90%; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #fff; text-shadow: 0 0 10px #fff; }
        .modal-message { font-size: 1.1rem; color: #ccc; line-height: 1.5; margin-bottom: 1.5rem; }
        .modal-button { background: #3b82f6; color: white; padding: 0.75rem 2rem; border-radius: 9999px; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
        .modal-button:hover { background: #2563eb; }

        /* === 3D SUPER HIDUP HEADLINE (standalone) === */
        .x3d{
          --c1:#ffe259; --c2:#22d3ee; --stroke:#0b1220;
          font-family: Orbitron, Bebas Neue, Inter, sans-serif;
          font-weight:900; line-height:1;
          font-size:clamp(32px, 8vw, 96px);
          letter-spacing:.04em; position:relative; display:inline-block;
          background:linear-gradient(90deg,var(--c1),#fff,var(--c2));
          -webkit-background-clip:text; background-clip:text; color:transparent;
          transform-style:preserve-3d;
          text-shadow:0 0 24px rgba(255,255,255,.35), 0 0 44px rgba(34,211,238,.28);
        }
        .x3d::before{
          content:attr(data-text); position:absolute; inset:0; color:var(--stroke); z-index:-1;
          text-shadow:
            1px 1px 0 var(--stroke),2px 2px 0 var(--stroke),3px 3px 0 var(--stroke),
            4px 4px 0 var(--stroke),5px 5px 0 var(--stroke),6px 6px 0 var(--stroke),
            7px 7px 0 var(--stroke),8px 8px 0 var(--stroke),9px 9px 0 var(--stroke),
            10px 10px 0 var(--stroke),11px 11px 0 var(--stroke),12px 12px 0 var(--stroke),
            13px 13px 0 var(--stroke),14px 14px 0 var(--stroke);
          filter: drop-shadow(0 10px 30px rgba(0,0,0,.45));
        }
        .x3d::after{
          content:attr(data-text); position:absolute; inset:0; mix-blend-mode:screen; opacity:.8;
          text-shadow:1px 0 0 rgba(0,238,255,.7), -1px 0 0 rgba(255,0,128,.6), 0 0 18px rgba(255,255,255,.25);
        }
        .x3d__shine{
          position:absolute; inset:-6%; border-radius:12px; pointer-events:none;
          background:linear-gradient(105deg, transparent 0%, rgba(255,255,255,.65) 50%, transparent 100%);
          filter: blur(10px); opacity:.0; transform: translateX(-120%);
          animation: x3dSweep 3.2s ease-in-out infinite 1s;
        }
        @keyframes x3dSweep{
          10%{ opacity:.0; transform: translateX(-120%); }
          20%{ opacity:.7; }
          50%{ opacity:.85; transform: translateX(0%); }
          80%{ opacity:.0; transform: translateX(120%); }
          100%{ opacity:.0; transform: translateX(120%); }
        }
        @keyframes x3dFlick{ 0%,100%{ filter:brightness(1) } 50%{ filter:brightness(1.1) } }
        .x3d{ animation: x3dFlick 2.8s ease-in-out infinite; }
        .x3d.is-small{ font-size:clamp(20px,4.2vw,48px) }
    </style>
</head>
<body class="flex flex-col min-h-screen overflow-x-hidden" style="overflow-y:auto;">
    <!-- FIXED BACKGROUNDS for Welcome/Game -->
    <div id="bgHero" class="bg-hero"><div class="shine-effect"></div></div>
    <div id="bgGame" class="bg-game hidden"><div class="shine-effect-gold"></div></div>

    <!-- HEADER (global) -->
    <header class="header-full fixed z-50 p-0 m-0">
        <nav class="w-full bg-gradient-to-r from-slate-900 via-indigo-900 to-purple-900 shadow-md">
            <div class="w-full flex items-center justify-between gap-3 px-3 sm:px-6 py-3">
                <a href="#" class="text-xl sm:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">BELEGENDBET</a>
                <button id="btnHome" class="hover:text-white px-5 py-2 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-xl font-semibold shadow-lg transition">Beranda</button>
            </div>
        </nav>
    </header>
    <div class="h-16"></div>

    <!-- MAIN: 2 SCREEN DALAM 1 FILE (Welcome + Game) -->
    <main class="flex-grow flex flex-col items-center justify-start w-full relative z-10">

        <!-- SCREEN 1: WELCOME -->
        <section id="screen-welcome" class="w-full flex flex-col items-center justify-start pt-2 pb-0 px-0 section-content">
            <div class="hero-map-frame full-bleed">
                <div class="neon-glow-border">
                    <img src="https://blogger.googleusercontent.com/img/a/AVvXsEi0AVbrC-wW523J76as712cp6lKlhP5hmSeH7CKJYyQZzKZweuzqF7mE4ieM8Wx5nSXlRKVymmcSdjQ2JdVR6tkqknE1E0GqhZDSCbpEjmqOzSPX34EKQ1P0yTXPZllqefxsSso2IzUNvxAOK2xRNUkBZcRIwZ9In9egAaOJ_SxYzQu-nEoHz9ptyq3Vgw" alt="Peta Harta Karun" class="hero-map-img select-none pointer-events-none" />
                </div>
            </div>
            <div class="w-full flex flex-col items-center justify-center mt-6 mb-1">
                <!-- GANTI JUDUL LAMA DENGAN 3D HEADLINE -->
                <h1 class="x3d mt-2 mb-2 text-center" data-text="WELCOME TO THE TREASURE MAP ONE PIECE!">WELCOME TO THE TREASURE MAP ONE PIECE!
                  <span class="x3d__shine" aria-hidden="true"></span>
                </h1>

                <div class="flex flex-col items-center gap-4 mt-8 mb-2 w-full max-w-xs">
                    <input id="inpUser" type="text" placeholder="User ID" class="w-full px-4 py-3 rounded-xl border-2 border-blue-400 text-lg font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-500 bg-slate-900 text-white placeholder:text-blue-300" autocomplete="off" />
                    <input id="inpKupon" type="text" placeholder="Kode Kupon" class="w-full px-4 py-3 rounded-xl border-2 border-green-400 text-lg font-semibold text-center focus:outline-none focus:ring-2 focus:ring-green-500 bg-slate-900 text-white placeholder:text-green-300" autocomplete="off" />
                    <button id="btnStart" class="hero-btn bg-gradient-to-r from-blue-500 to-green-500 text-white shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 w-full">Mulai Sekarang</button>
                </div>
            </div>
        </section>

        <!-- SCREEN 2: GAME / KARTU -->
        <section id="screen-game" class="hidden py-8 mx-auto max-w-7xl px-4 text-center w-full section-content">
            <h2 class="neon-title">TEMUKAN PULAU HARTA KARUN</h2>
            <div id="island-container">
                <!-- Island cards will be dynamically generated here -->
            </div>
            <button id="spinButton">PUTAR PENGACAK PULAU!</button>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="mt-8 py-5 text-center text-gray-400 text-sm border-t border-slate-700 bg-slate-900 z-50 relative">
        <p>&copy; 2024 BELEGENDBET. Hak Cipta Dilindungi Undang-Undang.</p>
    </footer>

    <!-- CUSTOM MODAL HTML -->
    <div id="modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 id="modalTitle" class="modal-title"></h3>
            <p id="modalMessage" class="modal-message"></p>
            <button id="modalButton" class="modal-button">OK</button>
        </div>
    </div>

    <script>
        (function(){
            // --- DATA FOR DYNAMIC CARD GENERATION ---
            const islandData = [
                { id: 'A', front: 'https://i.ibb.co/mC1vxmwP/ASAL-JADI-MASUK-AJA-4.png', back: 'https://i.postimg.cc/wvLQbgZ6/ASAL-JADI-MASUK-AJA-6.png' },
                { id: 'B', front: 'https://i.ibb.co/mC1vxmwP/ASAL-JADI-MASUK-AJA-4.png', back: 'https://i.postimg.cc/pT6q3sXZ/ASAL-JADI-MASUK-AJA-5.png' },
                { id: 'C', front: 'https://i.ibb.co/mC1vxmwP/ASAL-JADI-MASUK-AJA-4.png', back: 'https://i.postimg.cc/hPZgGBZ4/ASAL-JADI-MASUK-AJA-7.png' },
                { id: 'D', front: 'https://i.ibb.co/mC1vxmwP/ASAL-JADI-MASUK-AJA-4.png', back: 'https://i.postimg.cc/NMx86bZD/ASAL-JADI-MASUK-AJA-8.png' },
            ];

            // ====== ELEMENTS ======
            const bgHero = document.getElementById('bgHero');
            const bgGame = document.getElementById('bgGame');
            const scrWelcome = document.getElementById('screen-welcome');
            const scrGame = document.getElementById('screen-game');
            const btnHome = document.getElementById('btnHome');
            const btnStart = document.getElementById('btnStart');
            const inpUser = document.getElementById('inpUser');
            const inpKupon = document.getElementById('inpKupon');
            const islandContainer = document.getElementById('island-container');
            const spinButton = document.getElementById('spinButton');
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalButton = document.getElementById('modalButton');

            // ====== STATE ======
            let isSpinning = false;
            let canPick = false;
            let spinInterval = null;

            // ====== UTIL FUNCTIONS ======
            const show = el => el.classList.remove('hidden');
            const hide = el => el.classList.add('hidden');
            const saveSession = (u, k) => localStorage.setItem('tm_session', JSON.stringify({ userId: u, kupon: k, ts: Date.now() }));

            // Custom modal function to replace `alert()`
            function showModal(title, message, callback = null) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                show(modal);
                // Add a transition class after a short delay
                setTimeout(() => modal.classList.add('show'), 10);
                
                modalButton.onclick = () => {
                    modal.classList.remove('show');
                    setTimeout(() => hide(modal), 300); // Hide after transition
                    if (callback) callback();
                };
            }

            function showScreen(name) {
                hide(scrWelcome);
                hide(scrGame);
                if (name === 'welcome') {
                    show(bgHero);
                    hide(bgGame);
                    show(scrWelcome);
                }
                if (name === 'game') {
                    hide(bgHero);
                    show(bgGame);
                    show(scrGame);
                }
            }

            // --- WELCOME SCREEN LOGIC ---
            btnStart.addEventListener('click', () => {
                const u = (inpUser.value || '').trim();
                const k = (inpKupon.value || '').trim();
                if (!u || !k) {
                    showModal('Oops!', 'Silakan masukkan User ID dan Kode Kupon!');
                    return;
                }
                saveSession(u, k);
                showScreen('game');
                generateIslands(); // Generate cards when game screen is shown
            });

            btnHome.addEventListener('click', () => {
                resetGame();
                showScreen('welcome');
            });

            // --- GAME LOGIC ---

            // Function to generate card elements dynamically
            function generateIslands() {
                islandContainer.innerHTML = '';
                islandData.forEach((island, index) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'island-card-wrapper';
                    wrapper.setAttribute('data-index', index);
                    wrapper.setAttribute('data-id', island.id);
                    wrapper.innerHTML = `
                        <div class="island-card">
                            <div class="island-front"><img src="${island.front}" alt="Logo" class="card-front-logo" onerror="this.src='https://placehold.co/200x300/4a5568/a0aec0?text=Logo+Missing'" /></div>
                            <div class="island-back"><img src="${island.back}" alt="Pulau ${island.id}" class="island-img" onerror="this.src='https://placehold.co/200x300/4a5568/a0aec0?text=Pulau+${island.id}+Missing'" /></div>
                        </div>
                    `;
                    islandContainer.appendChild(wrapper);
                });
            }

            // Function to shuffle the cards by re-appending them to a new order
            function shuffleCards() {
                const cards = Array.from(islandContainer.children);
                for (let i = cards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    islandContainer.insertBefore(cards[j], cards[i].nextSibling);
                }
            }

            function startSpin() {
                if (isSpinning) return;
                resetGame();
                isSpinning = true;
                canPick = false;
                spinButton.disabled = true;
                spinButton.textContent = 'Mengacak...';

                const islandCards = document.querySelectorAll('.island-card');
                islandCards.forEach(c => c.classList.add('shuffling-anim'));
                
                let count = 0;
                const totalDuration = 2000; // 2 seconds
                const shuffleSpeed = 80;
                const totalShuffles = Math.floor(totalDuration / shuffleSpeed);

                spinInterval = setInterval(() => {
                    shuffleCards();
                    count++;
                    if (count >= totalShuffles) {
                        clearInterval(spinInterval);
                        isSpinning = false;
                        canPick = true;
                        spinButton.textContent = 'PILIH SALAH SATU PULAU!';
                        islandCards.forEach(c => c.classList.remove('shuffling-anim'));
                    }
                }, shuffleSpeed);
            }

            function flipCard(cardWrapper) {
                if (!canPick || cardWrapper.classList.contains('flipped')) return;
                const card = cardWrapper.querySelector('.island-card');
                card.classList.add('flipped');
                canPick = false;
                spinButton.textContent = 'MULAI BARU';
                spinButton.disabled = false;

                const islandId = cardWrapper.getAttribute('data-id');

                setTimeout(() => {
                    if (islandId === 'A') {
                        showModal('Selamat!', 'Anda menemukan Pulau Harta Karun! Lanjut ke halaman selanjutnya.', () => {
                            window.location.href = 'mystery-a.html';
                        });
                    } else {
                        showModal('Maaf!', `Pulau ${islandId} masih disiapkan, BOS.`);
                    }
                }, 700);
            }

            function resetGame() {
                clearInterval(spinInterval);
                isSpinning = false;
                canPick = false;
                const islandWrappers = document.querySelectorAll('.island-card-wrapper');
                islandWrappers.forEach(w => w.querySelector('.island-card').classList.remove('flipped', 'shuffling-anim'));
                spinButton.textContent = 'PUTAR PENGACAK PULAU!';
                spinButton.disabled = false;
                // Re-shuffle the cards for a new game
                shuffleCards();
            }

            // --- EVENT LISTENERS ---
            spinButton.addEventListener('click', () => {
                if (spinButton.textContent === 'MULAI BARU') resetGame();
                else startSpin();
            });

            islandContainer.addEventListener('click', e => {
                if (!canPick) return;
                const wrap = e.target.closest('.island-card-wrapper');
                if (wrap) flipCard(wrap);
            });

            // --- INITIALIZATION ---
            showScreen('welcome');
        })();
    </script>

    <!-- JS Parallax kecil buat 3D headline (tidak ganggu fungsi lain) -->
    <script>
      (function(){
        const els=document.querySelectorAll('.x3d');
        function mv(e){
          const rx=((e.clientY/innerHeight)-.5)*-10;
          const ry=((e.clientX/innerWidth)-.5)* 10;
          els.forEach(el=> el.style.transform=`rotateX(${rx}deg) rotateY(${ry}deg)`);
        }
        addEventListener('pointermove', mv, {passive:true});
      })();
    </script>
</body>
</html>
